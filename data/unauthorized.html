<!DOCTYPE html>

<head>
<meta charset="utf-8">

<!-- Load d3.js -->
    <script src="https://unpkg.com/d3@5.6.0/dist/d3.min.js"></script>
    <script src="https://d3js.org/d3-format.v2.min.js"></script>

<!-- Create a div where the graph will take place -->

<style>
    
    h1 {
        font-family: sans-serif;
        text-align: center;
        color: steelblue;
    }
        body {
            font-family: 'Open Sans', sans-serif;
        }
        
        div#layout {
            text-align: center;
        }
        
        div#container {
            width: 1000px;
            height: 600px;
            margin: auto;
            background-color; 2F4A6D;
        }
        
        svg {
            width: 100%;
            height: 100%;
        }
      
    .bar:hover {
        fill: brown;
    }
    
    .toolTip {
        position: absolute;
        display: none;
        min-width: 40px;
        height: auto;
        background: none repeat scroll 0 0 #ffffff;
        border: 1px solid #6F257F;
        padding: 4px;
        text-align: center;
    }
    
rect {
  fill: steelblue;
}

text {
    font-size: 1.5em;
    font-family: sans-serif;
}

.tick text {
    font-size: 1.2em
    fill: #635F5D;
}

.tick line {
    stroke: #C0C0BB;
}

.axis-label {
    font-size: 2em;
    fill: #8E8883;
}

    
</style>
    
</head>
<body>

    <h1>Unauthorized Immigrants in South Korea (2018)</h1>
    <div id='layout'>
        
        <div id='container'>
      
    <svg width="960" height="500"></svg>
            
    <script>
      
    (function (d3) {
  'use strict';

  const xAxisLabelText = 'Population';

  const svg = d3.select('svg');
  const svgContainer = d3.select('#container')
  
  const margin = 80;
  const width = 1000 - 2 * margin;
  const height = 600 - 2 * margin;
  
  const chart = svg.append('g')
                    .attr('transform', `translate(${margin},${margin})`);

  const render = data => {
    const xValue = d => d['population'];
    const yValue = d => d.country;
    const margin = { top: 80, right: 40, bottom: 77, left: 180 };
    const innerWidth = width - margin.left - margin.right;
    const innerHeight = height - margin.top - margin.bottom;
    
    const xScale = d3.scaleLinear()
      .domain([0, d3.max(data, xValue)])
      .range([0, innerWidth]);
    
    const yScale = d3.scaleBand()
      .domain(data.map(yValue))
      .range([0, innerHeight])
      .padding(0.1);
    
    const g = svg.append('g')
      .attr('transform', `translate(${margin.left},${margin.top})`);
    
    const xAxisTickFormat = number =>
      d3.format(',d')(number)
        .replace('G', 'B');
    
    const xAxis = d3.axisBottom(xScale)
      .tickFormat(xAxisTickFormat)
      .tickSize(-innerHeight);
    
    g.append('g')
      .call(d3.axisLeft(yScale))
      .selectAll('.domain, .tick line')
        .remove();
    
    const xAxisG = g.append('g').call(xAxis)
      .attr('transform', `translate(0,${innerHeight})`);
    
    xAxisG.select('.domain').remove();
    
    xAxisG.append('text')
        .attr('class', 'axis-label')
        .attr('y', 65)
        .attr('x', innerWidth / 2)
        .attr('fill', 'black')
        .text(xAxisLabelText);
    
    g.selectAll('rect').data(data)
      .enter().append('rect')
        .attr('y', d => yScale(yValue(d)))
        .attr('width', d => xScale(xValue(d)))
        .attr('height', yScale.bandwidth())
        .on("mousemove", function(d){
            tooltip
              .style("left", d3.event.pageX - 50 + "px")
              .style("top", d3.event.pageY - 70 + "px")
              .style("display", "inline-block")
              .html((d.population) + "<br>" + "Â£" + (d.country));
        })
    		.on("mouseout", function(d){ tooltip.style("display", "none");});
    		.on("mouseout", function(d){ tooltip.style("display", "none");});
    });
    
    g.append('text')
        .attr('class', 'title')
        .attr('y', -10)
        .text(titleText);
  };

  d3.csv("https://gist.githubusercontent.com/Saemmool/b99022276d9fd38b8e3ef34cf4cd23d5/raw/f2420ff0843af7e672985b7774cd70654c34d609/unauthorized%2520immigrants").then(data => {
    data.forEach(d => {
      d.population = +d.population;
    });
    render(data);
  });

}(d3));
        
    </script>
            
        </div>
    </div>
      
  </body>