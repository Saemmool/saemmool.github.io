<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>Unauthorized Immigrants in South Korea</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/d3@5.6.0/dist/d3.min.js"></script>
      
    <style>
    
        body {
            font-family: 'Open Sans', sans-serif;
        }
        
        div#layout {
            text-align: center;
        }
        
        div#container {
            width: 1000px;
            height: 600px;
            margin: auto;
            background-color; 2F4A6D;
        }
        
        svg {
            width: 100%;
            height: 100%;
        }
      
    </style>
      
  </head>
  <body>
    
    <div id='layout'>
        
        <div id='container'>
      
    <svg width="960" height="500"></svg>
    <script src="https://d3js.org/d3-format.v2.min.js"></script>
            
    <script>
      
    (function (d3) {
  'use strict';

  const titleText = 'Unauthorized Immigrants in South Korea (2018)';
  const xAxisLabelText = 'Population';

  const svg = d3.select('svg');
  const svgContainer = d3.select('#container')
  
  const margin = 80;
  const width = 1000 - 2 * margin;
  const height = 600 - 2 * margin;
  
  const chart = svg.append('g')
                    .attr('transform', `translate(${margin},${margin})`);

  const render = data => {
    const xValue = d => d['population'];
    const yValue = d => d.country;
    const margin = { top: 80, right: 40, bottom: 77, left: 180 };
    const innerWidth = width - margin.left - margin.right;
    const innerHeight = height - margin.top - margin.bottom;
    
    const xScale = d3.scaleLinear()
      .domain([0, d3.max(data, xValue)])
      .range([0, innerWidth]);
    
    const yScale = d3.scaleBand()
      .domain(data.map(yValue))
      .range([0, innerHeight])
      .padding(0.1);
    
    const g = svg.append('g')
      .attr('transform', `translate(${margin.left},${margin.top})`);
    
    const xAxisTickFormat = number =>
      d3.format(',d')(number)
        .replace('G', 'B');
    
    const xAxis = d3.axisBottom(xScale)
      .tickFormat(xAxisTickFormat)
      .tickSize(-innerHeight);
    
    g.append('g')
      .call(d3.axisLeft(yScale))
      .selectAll('.domain, .tick line')
        .remove();
    
    const xAxisG = g.append('g').call(xAxis)
      .attr('transform', `translate(0,${innerHeight})`);
    
    xAxisG.select('.domain').remove();
    
    xAxisG.append('text')
        .attr('class', 'axis-label')
        .attr('y', 65)
        .attr('x', innerWidth / 2)
        .attr('fill', 'black')
        .text(xAxisLabelText);
    
    g.selectAll('rect').data(data)
      .enter().append('rect')
        .attr('y', d => yScale(yValue(d)))
        .attr('width', d => xScale(xValue(d)))
        .attr('height', yScale.bandwidth());
    
    g.append('text')
        .attr('class', 'title')
        .attr('y', -10)
        .text(titleText);
  };

  d3.csv('mydata.csv').then(data => {
    data.forEach(d => {
      d.population = +d.population;
    });
    render(data);
  });

}(d3));
        
    </script>
            
        </div>
    </div>
      
  </body>
</html>