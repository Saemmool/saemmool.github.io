<!DOCTYPE html>
<html>
<head>
  <title>d3.tip.js - Tooltips for D3</title>
  <meta charset="utf-8" />
  <title>Bar Chart</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
  
</head>
<body>
  <div id="graph">

  </div>
  <script>
   
 export default function define(runtime, observer) {
  const main = runtime.module();
  main.variable(observer()).define(["md"], function(md){return(
md`# Animated Bar Chart with Tooltip D3 6.0`
)});
  main.variable(observer("chart")).define("chart", ["d3","width","height","data","staticColor","x","y","tooltip","hoverColor"], function(d3,width,height,data,staticColor,x,y,tooltip,hoverColor)
{
  const svg = d3.create("svg")
      .attr("viewBox", [0, 0, width, height]);
  
  const rect = svg
      .selectAll('g')
      .data(data)
      .enter()
      .append('rect')
      .attr('fill', staticColor)
      .attr('x', (d, i) => x(d.country))
      .attr('width', x.bandwidth())
      .attr('y', d => y(0))
      .attr('height', d => height - y(0))
      .on('mouseover', function (event,d, i) {
          tooltip
            .html(
              `<div>Country: ${d.country}</div><div>Value: ${d.value}</div>`
            )
            .style('visibility', 'visible');
          d3.select(this).transition().attr('fill', hoverColor);
      })
      .on('mousemove', function (event) {
          tooltip
            .style('top', event.pageY - 10 + 'px')
            .style('left', event.pageX + 10 + 'px');
      })
      .on('mouseout', function (event) {
          tooltip.html(``).style('visibility', 'hidden');
          d3.select(this).transition().attr('fill', staticColor);
      });
  
  rect
      .transition()
      .ease(d3.easeLinear)
      .duration(800)
      .attr('y', d => y(d.value))
      .attr('height', d => height - y(d.value))
      .delay((d, i) => i * 100);

  return svg.node();
}
);
  main.variable(observer("width")).define("width", function(){return(
800
)});
  main.variable(observer("height")).define("height", function(){return(
400
)});
  main.variable(observer("margin")).define("margin", function(){return(
{top: 20, right: 30, bottom: 30, left: 40}
)});
  main.variable(observer("rawData")).define("rawData", function(){return(
[
        {
          country: 'United States',
          value: 12394
        },
        {
          country: 'Russia',
          value: 6148
        },
        {
          country: 'Germany (FRG)',
          value: 8653
        },
        {
          country: 'France',
          value: 7162
        },
        {
          country: 'United Kingdom',
          value: 9214
        },
        {
          country: 'China',
          value: 4131
        },
        {
          country: 'Spain',
          value: 2814
        },
        {
          country: 'Netherlands',
          value: 3167
        },
        {
          country: 'Italy',
          value: 1660
        },
        {
          country: 'Israel',
          value: 1263
        }
      ]
)});
  main.variable(observer("data")).define("data", ["sort","rawData"], function(sort,rawData){return(
sort(rawData)
)});
  main.variable(observer("staticColor")).define("staticColor", function(){return(
'#437c90'
)});
  main.variable(observer("hoverColor")).define("hoverColor", function(){return(
'#eec42d'
)});
  main.variable(observer("tooltip")).define("tooltip", ["d3"], function(d3){return(
d3
    .select('body')
    .append('div')
    .attr('class', 'd3-tooltip')
    .style('position', 'absolute')
    .style('z-index', '10')
    .style('visibility', 'hidden')
    .style('padding', '10px')
    .style('background', 'rgba(0,0,0,0.6)')
    .style('border-radius', '4px')
    .style('color', '#fff')
    .text('a simple tooltip')
)});
  main.variable(observer("x")).define("x", ["d3","width","data"], function(d3,width,data){return(
d3
  .scaleBand()
  .range([0, width])
  .domain(data.map(d => d.country))
  .padding(0.2)
)});
  main.variable(observer("y")).define("y", ["d3","data","height"], function(d3,data,height){return(
d3
  .scaleLinear()
  .domain([0, d3.max(data, d => d.value)])
  .range([height, 0])
)});
  main.variable(observer("sort")).define("sort", ["d3"], function(d3){return(
(data) => data.sort((a, b) => d3.ascending(a.value, b.value))
)});
  main.variable(observer("d3")).define("d3", ["require"], function(require){return(
require("d3@6")
)});
  return main;
}

      
  </script>
</body>
</html>